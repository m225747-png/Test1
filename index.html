<!DOCTYPE html>
<html>
<head>
    <title>簡易下樓梯遊戲</title>
    <style>
        canvas { border: 2px solid #000; background: #f0f0f0; display: block; margin: 0 auto; }
        body { text-align: center; font-family: Arial; }
    </style>
</head>
<body>
    <h1>下樓梯 Demo</h1>
    <canvas id="gameCanvas" width="400" height="500"></canvas>
    <p>使用 左右方向鍵 控制</p>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");

        // 遊戲參數
        let player = { x: 200, y: 100, width: 20, height: 20, speed: 5, dy: 0 };
        let platforms = [];
        let gravity = 0.5;
        let gameSpeed = 2;
        let keys = {};

        // 初始化階梯
        for(let i=0; i<5; i++) {
            platforms.push({ x: Math.random()*300, y: i*100 + 200, w: 80, h: 10 });
        }

        function draw() {
            // 清除畫布
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 畫玩家
            ctx.fillStyle = "red";
            ctx.fillRect(player.x, player.y, player.width, player.height);

            // 畫階梯
            ctx.fillStyle = "black";
            platforms.forEach(p => ctx.fillRect(p.x, p.y, p.w, p.h));

            update();
            requestAnimationFrame(draw);
        }

        function update() {
            // 玩家左右移動
            if (keys["ArrowLeft"] && player.x > 0) player.x -= player.speed;
            if (keys["ArrowRight"] && player.x < canvas.width - player.width) player.x += player.speed;

            // 重力加速
            player.dy += gravity;
            player.y += player.dy;

            // 階梯上升邏輯
            let onPlatform = false;
            platforms.forEach(p => {
                p.y -= gameSpeed; // 階梯往上移

                // 碰撞偵測 (站在階梯上)
                if (player.x < p.x + p.w && player.x + player.width > p.x &&
                    player.y + player.height > p.y && player.y + player.height < p.y + p.h + player.dy) {
                    player.y = p.y - player.height;
                    player.dy = 0;
                    onPlatform = true;
                }
            });

            // 如果階梯移出螢幕，從底部重新生成
            if (platforms[0].y < 0) {
                platforms.shift();
                platforms.push({ x: Math.random()*320, y: 500, w: 80, h: 10 });
            }

            // 遊戲結束判定
            if (player.y < 0 || player.y > canvas.height) {
                alert("遊戲結束！");
                player.y = 100; player.dy = 0; // 重置
            }
        }

        window.addEventListener("keydown", e => keys[e.code] = true);
        window.addEventListener("keyup", e => keys[e.code] = false);

        draw();
    </script>
</body>
</html>
